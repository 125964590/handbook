(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{528:function(e,n){e.exports='\x3c!--\ntitle: Seafile\nsort: 7\n--\x3e\n\n部署 Seafile 搭建自己的网盘\n\nSeafile 是一个开源的文件云存储平台，解决文件集中存储、同步、多平台访问的问，允许用户创建“群组”，在群组内共享和同步文件，方便了团队协同工作。\n\n\n## 安装依赖\n\n```bash\n# 在 CentOS 7 下\n# (MariaDB 是 MySQL 的分支)\nyum install mariadb-server\n\n# 如果以来有问题 \n# 尝试在后面加上参数  --skip-broken\nyum install python-setuptools python-imaging python-ldap MySQL-python python-memcached python-urllib3\n```\n\nyum 安装 mysqldb-python 后面seafile安装报错，需要通过 python 的工具pip来安装MySQL-python `pip install MySQL-python`\n\n## 下载\n\n在这里下载[seafile-server_6.0.7_x86-64.tar.gz](https://www.seafile.com/download/)，你可以选择你需要的版本\n\n```bash\n# 查看系统版本\ncat /proc/version\nwget http://download-cn.seafile.com/seafile-server_6.0.7_x86-64.tar.gz\n\n# 解压\ntar -zxvf seafile-server_6.0.7_x86-64.tar.gz\n\n# 解压放到一个目录\ncd seafile-server-*\n```\n\n## 安装 \n\n我的数据库使用MySQL，你需要先在数据库中建立一个 MySQL 用户 `seafile`。\n\n```bash\n# 登录MySQL创建一个用户\nmysql -uroot -p\n\n# 创建用户设置密码\nmysql> Create USER \'seafile\'@\'%\' IDENTIFIED BY \'123456\';\n# 执行下面语句立即生效\nmysql> flush privileges;\n```\n\n运行`./setup-seafile-mysql.sh`安装脚本并回答预设问题\n\n```bash\n./setup-seafile-mysql.sh\n  Checking python on this machine ...\n  Checking python module: setuptools ... Done.\n  Checking python module: python-imaging ... Done.\n  Checking python module: python-mysqldb ... Done.\n\n-----------------------------------------------------------------\nThis script will guide you to setup your seafile server using MySQL.\nMake sure you have read seafile server manual at\n\n        https://github.com/haiwen/seafile/wiki\n\nPress ENTER to continue\n-----------------------------------------------------------------\n\nWhat is the name of the server? It will be displayed on the client.\n3 - 15 letters or digits\n[ server name ] <填写 seafile 服务器的名字>\n\nWhat is the ip or domain of the server?\nFor example: www.mycompany.com, 192.168.1.101\n[ This server\'s ip or domain ] <seafile 服务器的 IP 地址或者域名>\n\nWhere do you want to put your seafile data?\nPlease use a volume with enough free space\n[ default "/home/www/jinpans/seafile-data" ]\n\nWhich port do you want to use for the seafile fileserver?\n[ default "8082" ]  [ seafile fileserver 使用的 TCP 端口 ]\n\n-------------------------------------------------------\nPlease choose a way to initialize seafile databases:\n-------------------------------------------------------\n\n[1] Create new ccnet/seafile/seahub databases\n    你需要提供根密码. 脚本程序会创建数据库和用户。\n[2] Use existing ccnet/seafile/seahub databases\n    ccnet/seafile/seahub 数据库应该已经被你（或者其他人）提前创建。\n[ 1 or 2 ] <选择一种创建 Seafile 数据库的方式>\n\nWhat is the host of mysql server?\n[ default "localhost" ]\n\nWhat is the port of mysql server?\n[ default "3306" ]\n\nWhat is the password of the mysql root user?\n[ root password ] <输入root密码>\n\nverifying password of user root ...  done\n\nEnter the name for mysql user of seafile. It would be created if not exists.\n[ default "seafile" ] <默认seafile的MySQL用户名，可以使用默认>\n\nEnter the password for mysql user "seafile":\n[ password for seafile ] <输入seafile密码>\n\nverifying password of user seafile ...  done\n\nEnter the database name for ccnet-server:\n[ default "ccnet-db" ]\n\nEnter the database name for seafile-server:\n[ default "seafile-db" ]\n\nEnter the database name for seahub:\n[ default "seahub-db" ]\n\n---------------------------------\nThis is your configuration\n---------------------------------\n\n    server name:            seafile 服务器的名字\n    server ip/domain:       192.168.1.101\n\n    seafile data dir:       /home/www/jinpans/seafile-data\n    fileserver port:        8082\n\n    database:               create new\n    ccnet database:         ccnet-db\n    seafile database:       seafile-db\n    seahub database:        seahub-db\n    database user:          seafile\n\n---------------------------------\nPress ENTER to continue, or Ctrl-C to abort\n---------------------------------\n\nGenerating ccnet configuration ...\n\ndone\nSuccessly create configuration dir /home/www/jinpans/ccnet.\nGenerating seafile configuration ...\n\nDone.\ndone\nGenerating seahub configuration ...\n\n----------------------------------------\nNow creating seahub database tables ...\n\n----------------------------------------\n\ncreating seafile-server-latest symbolic link ...  done\n\n-----------------------------------------------------------------\nYour seafile server configuration has been finished successfully.\n-----------------------------------------------------------------\n\nrun seafile server:     ./seafile.sh { start | stop | restart }\nrun seahub  server:     ./seahub.sh  { start <port> | stop | restart <port> }\n\n-----------------------------------------------------------------\nIf you are behind a firewall, remember to allow input/output of these tcp ports:\n-----------------------------------------------------------------\n\nport of seafile fileserver:   8082\nport of seahub:               8000\n\nWhen problems occur, Refer to\n\n        https://github.com/haiwen/seafile/wiki\n\n```\n\n上面算是结束了，然后在 seafile-server_6.0.7 目录下面，运行如下命令\n\n### 启动 Seafile\n\n```bash\n./seafile.sh start # 启动 Seafile 服务\n```\n\n### 启动 Seahub\n\n```bash\n./seahub.sh start <port>  # 启动 Seahub 网站 （默认运行在8000端口上）\n# 你第一次启动 seahub 时，seahub.sh 脚本会提示你创建一个 seafile 管理员帐号。\n\nLC_ALL is not set in ENV, set to en_US.UTF-8\nStarting seahub at port 8000 ...\n\n----------------------------------------\nIt\'s the first time you start the seafile server. Now let\'s create the admin account\n----------------------------------------\n\nWhat is the email for the admin account?\n[ admin email ] <这里输入邮箱地址>\n\nWhat is the password for the admin account?\n[ admin password ] <这里输入密码>\n\nEnter the password again:\n[ admin password again ] <这里确认输入密码>\n----------------------------------------\nSuccessfully created seafile admin\n----------------------------------------\nSeahub is started\nDone.\n```\n\n然后你可以打开它了：\n\n```bash\nhttp://192.168.1.111:8000/\n```\n\n## 备份\n\n备份数据库，假设你的数据库名分别为 `ccnet-db` , `seafile-db` 和 `seahubdb`，下面命令分别备份这三个数据库，同时要注意备份需要先建立好文件夹。\n\n```bash\nmysqldump -h localhost -uroot -p --opt ccnet-db > ./backup/databases/ccnet-db.sql.`date +"%Y-%m-%d-%H-%M-%S"`\nmysqldump -h localhost -uroot -p --opt seafile-db > ./backup/databases/seafile-db.sql.`date +"%Y-%m-%d-%H-%M-%S"`\nmysqldump -h localhost -uroot -p --opt seahub-db > ./backup/databases/seahub-db.sql.`date +"%Y-%m-%d-%H-%M-%S"`\n```\n\n备份文件\n\n```bash\nnohup cp -R ./seafile-data ./backup/data/seafile-data-`date +"%Y-%m-%d-%H-%M-%S"` 2>&1 &\nnohup cp -R ./seahub-data ./backup/data/seahub-data-`date +"%Y-%m-%d-%H-%M-%S"` 2>&1 &\n\n[1] 17294\n```\n\n## 恢复\n\n```bash\nmysql -uroot -p ccnet-db < ccnet-db.sql.2017-11-29-11-36-06 \nmysql -uroot -p seafile-db < seafile-db.sql.2017-11-29-11-36-06 \nmysql -uroot -p seahub-db < seahub-db.sql.2017-11-29-11-36-06 \n```\n\n## 服务管理\n\n```bash\n./seahub.sh stop       # 停止 Seafile 进程\n./seafile.sh stop      # 停止 Seahub\n\n./seafile.sh start     # 启动 Seafile 服务\n./seahub.sh start 8001 # 启动 Seahub 网站 （运行在8001端口上）\n\n./seafile.sh restart   # 停止当前的 Seafile 进程，然后重启 Seafile\n./seahub.sh restart    # 停止当前的 Seahub 进程，并在 8000 端口重新启动 Seahub\n```\n\n## 开机启动\n\n创建 systemd 服务文件`seafile.service`，记得将服务文件中的`${seafile_dir}`替换成你的安装目录\n\n```bash\nsudo vim /etc/systemd/system/seafile.service\n```\n\n文件内容如下：\n\n```bash\n[Unit]\nDescription=Seafile\n# add mysql.service or postgresql.service depending on your database to the line below\nAfter=network.target\n\n[Service]\nType=oneshot\nExecStart=${seafile_dir}/seafile-server-latest/seafile.sh start\nExecStop=${seafile_dir}/seafile-server-latest/seafile.sh stop\nRemainAfterExit=yes\nUser=seafile\nGroup=seafile\n\n[Install]\nWantedBy=multi-user.target\n```\n\n创建 systemd 服务文件 `seahub.service`，记得将服务文件中的`${seafile_dir}`替换成你的安装目录\n\n```bash\nsudo vim /etc/systemd/system/seahub.service\n```\n\n文件内容如下：\n\n```bash\n[Unit]\nDescription=Seafile hub\nAfter=network.target seafile.service\n\n[Service]\n# change start to start-fastcgi if you want to run fastcgi\nExecStart=${seafile_dir}/seafile-server-latest/seahub.sh start\nExecStop=${seafile_dir}/seafile-server-latest/seahub.sh stop\nUser=seafile\nGroup=seafile\nType=oneshot\nRemainAfterExit=yes\n\n[Install]\nWantedBy=multi-user.target\n```\n\n[Install]\nWantedBy=multi-user.target\n\n```bash\nsudo systemctl enable seafile.service\nsudo systemctl enable seahub.service\n```\n\n## 参考资料\n\n- [Seafile服务器手册中文版](https://www.gitbook.com/book/freeplant/seafile-manual-cn/details)\n- [Seafile for Github](https://github.com/haiwen/seafile)\n- [Seafile官网](http://seafile.com/)'}}]);